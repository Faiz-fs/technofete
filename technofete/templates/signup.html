<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technofete'23</title>
    <link rel="stylesheet" href="/static//css/login.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,200" />
    <link rel="stylesheet" href="https://kit.fontawesome.com/c5b6a2f026.css" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <form class="form-box" action="" method="post" id="formbox">
            <h1 id="title">Register</h1>
            <div class="input-group" id="input-group">
            </div>
            <div class="btn-field">
                <button type="button" id="signupBtn" onclick="register()">Register</button>
            </div>
        </form>
        <p id="tetx"></p>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/static/js/app.js"></script>
    <script type="text/javascript"></script>
    <script type="text/javascript">
        var text = ``;
        var n={{ data[1] }}
        for (let i = 1; i <= n; i++) {
            text += `<div class="input-field">
                    <span class="material-symbols-outlined">person</span>
                    <input type="text" placeholder="Name" name="Name${i}" id="Name${i}" required>
                </div>
                <div class="input-field">
                    <span class="material-symbols-outlined">mail</span>
                    <input type="email" placeholder="Email@mcet.in" name="Email${i}" id="Email${i}" required>
                </div>
                <div class="input-field">
                    <span class="material-symbols-outlined">call</span>
                    <input type="text" placeholder="Phoneno" name="Phone${i}" id="Phone${i}" required>
                </div>`;
        }
        document.getElementById("input-group").innerHTML = text;
        function register() {
            var event="{{ data[0] }}"
            var found=0
            var lst = []
            for (let i = 1; i <= n; i++) {
                var mail=document.getElementById("Email".concat(i)).value;
                var result = ""
                if(mail.includes("@mcet.in")){
                    var rollno=mail.replace("@mcet.in","");
                    result+=rollno+" ";
                    result += document.getElementById("Name".concat(i)).value.replace(/\s+/g,"") + " ";
                    result+= mail + " ";
                    result += document.getElementById("Phone".concat(i)).value + " ";
                    result +=event;
                    lst.push(result);
                }
                else{
                    alert("Enter valid mail Sample:727621bcs009@mcet.in")
                    found=1
                    break;
                }
                
                
                console.log(result);
            }
            fetch('/data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(lst)
            }).then(response => response.json())
                .then(data => {
                    console.log(data,found);
                    if(found==0  && data["message"]=="Successful"){
                        alert(data["message"]+"Registered");alert(data["message"])
                        window.location.href="https://technofete.onrender.com/";
                    }
                    else if(found==1){
                        document.getElementById("formbox").reset();
                    }
                    else if(data["message"]=="Event clash"){
                        alert(data["message"]);
                        window.history.back();
                        
                    }
                     // This will log the response from the Flask server
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            
            //$.post("/data", {javascript_data: JSON.stringify(lst)});
            ///document.getElementById("tetx").innerText=lst;
            //lst.forEach((element) => {
            //    console.log(element);
            //});
        }
    </script>
</body>

</html>
